# Email Deliverability Guide - Preventing Spam

## Why Emails Go to Spam

Emails can end up in spam folders due to:
1. **Missing Email Authentication** (SPF, DKIM, DMARC)
2. **Low Sender Reputation**
3. **Poor Email Content** (spam trigger words, formatting issues)
4. **Using Free Email Domains** (Gmail, Yahoo, etc.)
5. **Missing Proper Headers**

## Solutions Implemented

### ✅ 1. Improved Email Template
- Professional HTML structure
- Proper email formatting
- Removed spam trigger words
- Added company branding
- Better text-to-HTML ratio

### ✅ 2. Added Proper Email Headers
- Sender name with email
- Reply-To address
- Proper character encoding
- Configuration set support

## Required AWS SES Setup for Better Deliverability

### Step 1: Verify Your Domain (Recommended)

Instead of just verifying an email address, verify your entire domain:

1. **Go to AWS SES Console** → Verified identities
2. **Click "Create identity"** → Choose "Domain"
3. **Enter your domain**: `onlineelectricalwholesale.com.au`
4. **Follow the DNS setup instructions**:
   - Add DKIM records (3 CNAME records)
   - Add verification TXT record
   - Add SPF record (if not already present)

### Step 2: Set Up SPF Record

Add this TXT record to your domain's DNS:

```
Type: TXT
Name: @ (or your domain)
Value: v=spf1 include:amazonses.com ~all
```

### Step 3: Set Up DKIM (Automatic with Domain Verification)

When you verify your domain in AWS SES, it will provide 3 CNAME records to add to your DNS. These are automatically generated and must be added exactly as provided.

### Step 4: Set Up DMARC Record

Add this TXT record to your domain's DNS:

```
Type: TXT
Name: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@onlineelectricalwholesale.com.au
```

**DMARC Policy Options:**
- `p=none` - Monitor only (start here)
- `p=quarantine` - Send suspicious emails to spam
- `p=reject` - Reject suspicious emails (use after testing)

### Step 5: Update config.env

Once your domain is verified, update your `config.env`:

```env
# Use your verified domain email instead of Gmail
AWS_SES_FROM_EMAIL=noreply@onlineelectricalwholesale.com.au
AWS_SES_FROM_NAME=Online Electrical Wholesale
AWS_SES_REPLY_TO=support@onlineelectricalwholesale.com.au
COMPANY_NAME=Online Electrical Wholesale
COMPANY_WEBSITE=https://onlineelectricalwholesale.com.au
```

## Current Issue: Using Gmail Address

**Problem**: Using `sukhmindersingh1566@gmail.com` as sender has limitations:
- Gmail doesn't allow you to set up SPF/DKIM/DMARC for your domain
- Lower deliverability rates
- More likely to be marked as spam

**Solution**: 
1. Verify your domain `onlineelectricalwholesale.com.au` in AWS SES
2. Set up DNS records (SPF, DKIM, DMARC)
3. Use `noreply@onlineelectricalwholesale.com.au` as sender

## Testing Email Deliverability

### 1. Check Email Authentication

Use these tools to verify your email authentication:
- **MXToolbox**: https://mxtoolbox.com/spf.aspx
- **DMARC Analyzer**: https://dmarcian.com/dmarc-xml/
- **Mail-Tester**: https://www.mail-tester.com/

### 2. Test Your Emails

Send a test email and check:
- Does it arrive in inbox?
- Are SPF, DKIM, DMARC passing?
- What's the spam score?

### 3. Monitor AWS SES Metrics

1. Go to AWS SES Console → Account dashboard
2. Monitor:
   - Bounce rate (should be < 5%)
   - Complaint rate (should be < 0.1%)
   - Reputation score

## Best Practices

### ✅ Do's
- Use a verified domain email address
- Set up SPF, DKIM, and DMARC
- Use a professional sender name
- Include unsubscribe links (for marketing emails)
- Keep email content professional
- Monitor bounce and complaint rates

### ❌ Don'ts
- Don't use free email providers as sender (Gmail, Yahoo)
- Don't use spam trigger words (FREE, CLICK HERE, URGENT)
- Don't send to purchased email lists
- Don't ignore bounce/complaint rates
- Don't send too many emails too quickly

## Quick Fixes Applied

1. ✅ Improved HTML email template
2. ✅ Added proper sender name
3. ✅ Added Reply-To header
4. ✅ Better email structure
5. ✅ Professional formatting

## Next Steps

1. **Verify your domain** in AWS SES (not just email)
2. **Add DNS records** (SPF, DKIM, DMARC)
3. **Update config.env** to use domain email
4. **Test deliverability** using mail-tester.com
5. **Monitor metrics** in AWS SES console

## DNS Records Summary

Add these to your domain's DNS provider:

```
# SPF Record
Type: TXT
Name: @
Value: v=spf1 include:amazonses.com ~all

# DMARC Record
Type: TXT
Name: _dmarc
Value: v=DMARC1; p=none; rua=mailto:dmarc@onlineelectricalwholesale.com.au

# DKIM Records (3 CNAME records - provided by AWS SES when you verify domain)
# These will be automatically generated by AWS SES
```

## Testing After Setup

```bash
# Test email sending
npm run test-email your-email@example.com

# Then check:
# 1. Email arrives in inbox (not spam)
# 2. Check email headers for SPF/DKIM pass
# 3. Test on mail-tester.com for spam score
```

